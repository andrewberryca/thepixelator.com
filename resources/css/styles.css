/* ── Design tokens ──────────────────────────────────────────────────────── */
:root {
  --color-bg:        #f2f2f2;
  --color-surface:   #ffffff;
  --color-layer-bg:  #eeeeee;
  --color-layer-hover: #e3e3e3;
  --color-accent:    #174db0;
  --color-accent-hover: #2964cf;
  --color-muted:     #cccccc;
  --color-text:      #333333;
  --color-text-dim:  #999999;
  --color-link:      #4385ff;
  --color-danger:    #990000;
  --font:            11px/20px Verdana, sans-serif;
  --radius:          6px;
  --header-h:        120px;
}

/* ── Reset / base ───────────────────────────────────────────────────────── */
*, *::before, *::after { box-sizing: border-box; }

body {
  margin: 0;
  font: var(--font);
  color: var(--color-text);
  background-color: var(--color-bg);
  overflow-x: hidden;
}

select, input, textarea, optgroup, option {
  font: var(--font);
}
optgroup { font-weight: bold; }

a            { color: var(--color-link); text-decoration: none; }
a:hover      { text-decoration: underline; }
ul           { list-style: none; margin: 0; padding: 0; }

/* ── Header ─────────────────────────────────────────────────────────────── */
header {
  display:          flex;
  align-items:      flex-start;
  gap:              12px;
  padding:          12px 32px;
  background-color: var(--color-bg);
  position:         fixed;
  top:              0;
  left:             0;
  right:            0;
  z-index:          100;
}

#logo { flex-shrink: 0; margin-left: -20px; }

.header-text {
  flex: 1;
  min-width: 0;
  margin-top: 5px;
}
.header-text h1 {
  font-size:    28px;
  line-height:  1.1;
  font-weight:  bold;
  margin:       0 0 2px;
}
.header-text .tagline {
  font: var(--font);
  color: var(--color-text-dim);
  margin: 0;
}

/* Header nav buttons */
.header-nav { margin-top: 6px; }
.header-nav ul { display: flex; flex-direction: column; gap: 6px; }

.nav-btn {
  display:          block;
  cursor:           pointer;
  color:            var(--color-text);
  background-color: var(--color-muted);
  border:           none;
  border-radius:    var(--radius);
  padding:          4px 20px 4px 45px;
  font:             var(--font);
  text-align:       left;
  white-space:      nowrap;
  min-width:        160px;
}
.nav-btn:hover {
  background-color: var(--color-accent-hover);
  color: white;
}
.link-btn { background-image: url(../images/web.png);      background-repeat: no-repeat; background-position: 10px 3px; }
.js-btn   { background-image: url(../images/gear.png);     background-repeat: no-repeat; background-position: 10px 2px; }
.save-btn { background-image: url(../images/download.png); background-repeat: no-repeat; background-position: 10px 2px; }

/* ── Main layout ─────────────────────────────────────────────────────────── */
main {
  display:          flex;
  flex-direction:   row;
  align-items:      flex-start;
  gap:              20px;
  padding:          20px 30px;
  margin-top:       var(--header-h);
  background-color: var(--color-surface);
  min-width:        max-content; /* allow horizontal scroll for large canvases */
}

#col1 { flex-shrink: 0; width: 320px; }
#col2 { flex: 1; min-width: 0; }

/* ── Preset style buttons ────────────────────────────────────────────────── */
#preset-styles {
  display:         flex;
  align-items:     center;
  gap:             8px;
  padding-bottom:  10px;
}
#preset-style-list {
  display: flex;
  gap:     2px;
}
#preset-style-list li {
  width:            22px;
  text-align:       center;
  background-color: #efefef;
  border-radius:    3px;
  cursor:           pointer;
  user-select:      none;
  line-height:      22px;
}
#preset-style-list li:hover,
#preset-style-list li.selected {
  background-color: var(--color-accent);
  color: white;
}

/* ── Layer settings ──────────────────────────────────────────────────────── */
#settings    { margin-top: 10px; }
.add-layer-row { margin-top: 8px; }

.setting-group {
  position:         relative;
  border-radius:    10px;
  background-color: var(--color-layer-bg);
  margin-bottom:    10px;
  overflow:         hidden;
  transition:       background-color 0.1s;
}
.setting-group:hover    { background-color: var(--color-layer-hover); }
.setting-group.dragging { opacity: 0.5; }
.setting-group.drag-over { outline: 2px dashed var(--color-accent); }

/* Layer header (drag handle + enable checkbox + delete button) */
.layer-header {
  display:          flex;
  align-items:      center;
  justify-content:  space-between;
  background-color: var(--color-muted);
  border-radius:    10px 10px 0 0;
  padding:          2px 0 2px 6px;
  cursor:           grab;
  user-select:      none;
}
.layer-header:active { cursor: grabbing; }

.layer-num {
  display:     flex;
  align-items: center;
  gap:         4px;
}
.enabled-label { cursor: grab; font-style: italic; }

.delete-setting {
  width:              28px;
  height:             24px;
  background-color:   var(--color-muted);
  border:             none;
  border-radius:      0 10px 0 10px;
  cursor:             pointer;
  font-size:          14px;
  line-height:        1;
  color:              var(--color-text);
  flex-shrink:        0;
}
.delete-setting:hover {
  background-color: var(--color-danger);
  color: white;
}

/* Layer controls grid */
.layer-controls { padding: 8px 10px; }

.control-row {
  display:     flex;
  align-items: center;
  gap:         6px;
  height:      26px;
}
.control-row label {
  width:       60px;
  flex-shrink: 0;
  font:        var(--font);
}
.control-row select { flex: 1; }

/* ── Native range slider ─────────────────────────────────────────────────── */
input[type="range"] {
  flex:              1;
  height:            6px;
  appearance:        none;
  -webkit-appearance: none;
  background:        #d0d0d0;
  border-radius:     3px;
  outline:           none;
  cursor:            pointer;
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance:         none;
  width:              14px;
  height:             14px;
  border-radius:      50%;
  background:         var(--color-accent);
  cursor:             pointer;
}
input[type="range"]::-moz-range-thumb {
  width:        14px;
  height:       14px;
  border-radius: 50%;
  background:   var(--color-accent);
  border:       none;
  cursor:       pointer;
}

.range-val {
  width:      32px;
  flex-shrink: 0;
  text-align: right;
  color:      var(--color-text-dim);
  font-size:  10px;
}

/* ── View mode tabs ──────────────────────────────────────────────────────── */
#view-mode {
  display:       flex;
  gap:           3px;
  margin-bottom: 10px;
}
#view-mode li {
  background-color: var(--color-bg);
  padding:          0 12px;
  border-radius:    2px;
  height:           22px;
  line-height:      22px;
  cursor:           pointer;
  user-select:      none;
}
#view-mode li[aria-selected="true"],
#view-mode li:hover {
  background-color: var(--color-accent);
  color: white;
}

/* ── Image source controls ───────────────────────────────────────────────── */
.image-source-row {
  display:     flex;
  align-items: center;
  gap:         8px;
  margin-bottom: 6px;
}
.radio-label {
  display:     flex;
  align-items: center;
  gap:         4px;
  width:       90px;
  flex-shrink: 0;
  cursor:      pointer;
}
.image-source-field { display: flex; align-items: center; gap: 6px; }
.url-row { flex: 1; }
#image-url {
  flex:      1;
  min-width: 300px;
  max-width: 500px;
  padding:   2px 4px;
}

.spacer { height: 10px; }

/* ── Footer ─────────────────────────────────────────────────────────────── */
footer {
  display:          flex;
  gap:              0;
  padding:          20px 40px;
  background-color: var(--color-bg);
  position:         relative;
}
.fork-link {
  position: absolute;
  right:    40px;
  top:      0;
  margin-top: -20px;
}
footer nav { width: 270px; }
footer nav h2 {
  font:         var(--font);
  font-weight:  bold;
  color:        var(--color-text);
  margin:       0 0 4px;
}
footer nav li { color: var(--color-muted); margin-bottom: 2px; }
footer a      { color: var(--color-text-dim); }
footer a:hover { color: var(--color-link); }

/* ── Dialogs ─────────────────────────────────────────────────────────────── */
dialog {
  border:        none;
  border-radius: 8px;
  padding:       24px;
  max-width:     640px;
  width:         calc(100vw - 48px);
  box-shadow:    0 8px 32px rgba(0, 0, 0, 0.3);
  color:         #555;
}
dialog::backdrop {
  background: rgba(0, 0, 0, 0.5);
}
dialog h2 {
  margin: 0 0 12px;
  color:  var(--color-text);
  font-size: 16px;
}
dialog p  { margin: 0 0 12px; }
dialog a  { color: var(--color-link); }

dialog textarea {
  display:   block;
  width:     100%;
  height:    160px;
  color:     #002e83;
  font:      var(--font);
  resize:    vertical;
  margin-bottom: 12px;
}
#about-content textarea { height: 270px; }

#share-url {
  display:   block;
  width:     100%;
  font-size: 13px;
  padding:   4px 6px;
  margin-bottom: 12px;
}

#js-output { font-family: monospace; }

.dialog-actions {
  display:     flex;
  gap:         8px;
  justify-content: flex-end;
  margin-top:  4px;
}

/* Buttons */
button.btn-primary,
button.dialog-close {
  padding:          5px 16px;
  border:           none;
  border-radius:    4px;
  cursor:           pointer;
  font:             var(--font);
  background-color: var(--color-muted);
  color:            var(--color-text);
}
button.btn-primary {
  background-color: var(--color-accent);
  color:            white;
}
button.btn-primary:hover  { background-color: var(--color-accent-hover); }
button.dialog-close:hover { background-color: #aaa; }

/* About dialog */
#about-canvas   { display: block; max-width: 100%; margin-bottom: 10px; }
.toggle-btn {
  display:          inline-block;
  background-color: #f9f9f9;
  border:           1px solid #efefef;
  color:            var(--color-text);
  padding:          2px 8px;
  cursor:           pointer;
  font:             var(--font);
  border-radius:    3px;
  margin-bottom:    8px;
}
.toggle-btn:hover {
  background-color: #006699;
  color: white;
}
#swirly-source { height: 300px; font-family: monospace; font-size: 11px; }

/* ── Recovery panel ──────────────────────────────────────────────────────── */
#recovery-panel { margin-top: 14px; }

.recovery-note {
  margin: 0 0 12px;
  padding: 8px 12px;
  background: #fffbe6;
  border-left: 3px solid #e8b400;
  border-radius: 4px;
  font: var(--font);
  color: var(--color-text);
}

.recovery-methods {
  display:        flex;
  flex-direction: column;
  gap:            10px;
}

.recovery-card {
  background:     var(--color-layer-bg);
  border-radius:  8px;
  padding:        12px;
  display:        flex;
  flex-direction: row;
  gap:            12px;
  align-items:    flex-start;
}

/* Label column on the left, content on the right */
.recovery-card h3 {
  flex-shrink:  0;
  width:        160px;
  margin:       2px 0 0;
  font-size:    11px;
  font-weight:  bold;
  color:        var(--color-text);
}

.recovery-card-body {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.recovery-card p { margin: 0; font: var(--font); color: var(--color-text); }
.recovery-meta   { color: var(--color-text-dim) !important; font-style: italic; }
.recovery-tf-note { color: var(--color-text-dim) !important; }

.recovery-card-controls { font: var(--font); }
.recovery-card-controls select { font: var(--font); }

.btn-recover {
  margin-top:       auto;
  padding:          4px 10px;
  background-color: var(--color-accent);
  color:            white;
  border:           none;
  border-radius:    var(--radius);
  cursor:           pointer;
  font:             var(--font);
  align-self:       flex-start;
  white-space:      nowrap;
}
.btn-recover:hover    { background-color: var(--color-accent-hover); }
.btn-recover:disabled { opacity: 0.55; cursor: default; }

#recovery-output { margin-top: 14px; }

.recovery-output-header {
  display:     flex;
  align-items: center;
  gap:         12px;
  margin-bottom: 8px;
  font:        var(--font);
}
#recovery-status {
  color:       var(--color-text-dim);
  font-style:  italic;
}
#recovery-canvas { display: block; max-width: 100%; }
.recovery-actions { margin-top: 8px; }

/* ── Utilities ───────────────────────────────────────────────────────────── */
.hidden { display: none !important; }
